{% extends 'base.html' %}

{% block content %}
<div class="dashboard-grid">
    <!-- Scoreboard Section -->
    <section class="scoreboard-section">
        <h2>Huidige Stand</h2>
        <div class="player-cards">
            {% for player in players %}
            <div class="player-card {% if player.id == current_dealer_id %}dealer-card{% endif %}">
                <div class="player-name">
                    {{ player.name }}
                    {% if player.id == current_sitter_id %}
                    <span class="dealer-badge" style="background-color: var(--text-secondary);">Zit stil</span>
                    {% elif player.id == current_dealer_id %}
                    <span class="dealer-badge">Deler</span>
                    {% endif %}
                </div>
                <div class="player-score">{{ scores[player.id] }}</div>
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- Actions Section -->
    <section class="actions-section">
        <button id="addRoundBtn" class="btn btn-primary btn-large">+ Nieuwe Ronde</button>
        <form action="{{ url_for('end_game') }}" method="POST" class="inline-form">
            <button type="submit" class="btn btn-danger btn-small"
                onclick="return confirm('Weet je zeker dat je dit spel wilt beëindigen?')">Spel Beëindigen</button>
        </form>
    </section>

    <!-- History Section -->
    <section class="history-section">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3 style="margin: 0;">Laatste Rondes</h3>
            {% if rounds %}
            <button type="button" class="btn btn-warning" onclick="confirmUndo()">↶ Ongedaan Maken</button>
            {% endif %}
        </div>
        <table class="history-table">
            <thead>
                <tr>
                    <th>Ronde</th>
                    <th>Contract</th>
                    <th>Resultaat</th>
                    {% for player in players %}
                    <th>{{ player.name }}</th>
                    {% endfor %}
                    <th>Acties</th>
                </tr>
            </thead>
            <tbody>
                {% for round in rounds %}
                <tr>
                    <td>#{{ round.round_number }}</td>
                    <td>
                        {{ round.contract_type }}
                        {% if round.trump_suit %}
                        {% if round.trump_suit in ['harten', 'ruiten'] %}
                        <span class="suit-red">
                            {% else %}
                            <span class="suit-black">
                                {% endif %}
                                {% if round.trump_suit == 'harten' %}♥{% endif %}
                                {% if round.trump_suit == 'ruiten' %}♦{% endif %}
                                {% if round.trump_suit == 'klaveren' %}♣{% endif %}
                                {% if round.trump_suit == 'schoppen' %}♠{% endif %}
                            </span>
                            {% endif %}
                    </td>
                    <td>
                        <span class="status-badge {{ round.result|lower }}">{{ round.result }}</span>
                        {% if round.tricks %}({{ round.tricks }}){% endif %}
                    </td>
                    {% for player in players %}
                    <td>
                        {% if player.id == round.sitter_id %}
                        <span class="score-neutral">-</span>
                        {% else %}
                        {% if player.id == round.dealer_id %}
                        <span class="history-dealer-marker" title="Deler">D</span>
                        {% endif %}
                        {% set score = round.scores.get(player.id, 0) %}
                        {% if score > 0 %}
                        <span class="score-green">+{{ score }}</span>
                        {% elif score < 0 %} <span class="score-red">{{ score }}</span>
                            {% else %}
                            <span class="score-neutral">0</span>
                            {% endif %}
                            {% endif %}
                    </td>
                    {% endfor %}
                    <td class="action-buttons">
                        <button class="btn-icon btn-edit" onclick="openEditModal({{ round.round_number }})"
                            title="Bewerken">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                <path
                                    d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z" />
                            </svg>
                        </button>
                        <button class="btn-icon btn-delete" onclick="confirmDelete({{ round.round_number }})"
                            title="Verwijderen">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                <path
                                    d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z" />
                                <path fill-rule="evenodd"
                                    d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z" />
                            </svg>
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>
</div>

<!-- Add Round Modal -->
<div id="addRoundModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Ronde Toevoegen</h2>
        <form action="{{ url_for('add_round') }}" method="POST">
            <div class="form-group">
                <label for="contract">Contract</label>
                <select id="contract" name="contract" required
                    oninvalid="this.setCustomValidity('Kies een contract uit de lijst')"
                    oninput="this.setCustomValidity('')">
                    <option value="Vraag">Vraag</option>
                    <option value="Abondance">Abondance</option>
                    <option value="Miserie">Miserie</option>
                    <option value="Grote Miserie">Grote Miserie</option>
                    <option value="Troel">Troel</option>
                    <option value="Solo">Solo</option>
                </select>
            </div>

            <div class="form-group" id="trump-group">
                <label>Troef</label>
                <div class="radio-group">
                    <label class="trump-label"><input type="radio" name="trump_suit" value="harten"
                            oninvalid="this.setCustomValidity('Kies een troefkleur')" onclick="clearTrumpValidity()">
                        <span class="suit-red">♥</span> Harten</label>
                    <label class="trump-label"><input type="radio" name="trump_suit" value="ruiten"
                            oninvalid="this.setCustomValidity('Kies een troefkleur')" onclick="clearTrumpValidity()">
                        <span class="suit-red">♦</span> Ruiten</label>
                    <label class="trump-label"><input type="radio" name="trump_suit" value="klaveren"
                            oninvalid="this.setCustomValidity('Kies een troefkleur')" onclick="clearTrumpValidity()">
                        <span class="suit-black">♣</span> Klaveren</label>
                    <label class="trump-label"><input type="radio" name="trump_suit" value="schoppen"
                            oninvalid="this.setCustomValidity('Kies een troefkleur')" onclick="clearTrumpValidity()">
                        <span class="suit-black">♠</span> Schoppen</label>
                </div>
            </div>

            <div class="form-group">
                <label for="main_player">Speler (Indien van toepassing)</label>
                <select id="main_player" name="main_player">
                    {% for player in players %}
                    <option value="{{ player.id }}">{{ player.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group" id="partner-group">
                <label for="partner_id">Partner (Alleen bij Vraag)</label>
                <select id="partner_id" name="partner_id"
                    oninvalid="this.setCustomValidity('Selecteer een speler uit de lijst')"
                    oninput="this.setCustomValidity('')">
                    <option value="">Geen (Alleenspel)</option>
                    {% for player in players %}
                    <option value="{{ player.id }}">{{ player.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group" id="miserie-group" style="display:none;">
                <label>Spelers (Miserie / Grote Miserie)</label>
                <div class="miserie-players">
                    {% for player in players %}
                    <div class="miserie-player-row" data-player-id="{{ player.id }}">
                        <label class="checkbox-label">
                            <input type="checkbox" name="miserie_play_{{ player.id }}" value="1"
                                onchange="toggleMiserieResult(this, {{ player.id }})">
                            {{ player.name }}
                        </label>
                        <div class="miserie-result-options" id="miserie-result-{{ player.id }}"
                            style="display:none; margin-left: 10px;">
                            <label><input type="radio" name="miserie_result_{{ player.id }}" value="Gewonnen" checked>
                                Gewonnen</label>
                            <label><input type="radio" name="miserie_result_{{ player.id }}" value="Verloren">
                                Verloren</label>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="form-group">
                <label>Resultaat</label>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="result" value="Gewonnen" checked> Gewonnen
                    </label>
                    <label>
                        <input type="radio" name="result" value="Verloren"> Verloren
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label for="tricks">Extra Slagen / Details (Optioneel)</label>
                <input type="number" id="tricks" name="tricks" value="0" placeholder="0">
                <small>Bv. aantal overslagen bij Vraag</small>
            </div>

            <button type="submit" class="btn btn-primary full-width">Opslaan</button>
        </form>
    </div>
</div>

<!-- Confirm Delete Modal -->
<div id="confirmDeleteModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
        <span class="close" onclick="closeConfirmModal()">&times;</span>
        <h2>Bevestiging</h2>
        <p id="confirmMessage" style="margin: 20px 0;"></p>
        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
            <button type="button" class="btn" onclick="closeConfirmModal()"
                style="background: #6c757d;">Annuleren</button>
            <button type="button" class="btn btn-danger" id="confirmOkBtn">Verwijderen</button>
        </div>
    </div>
</div>

<!-- Alert Modal -->
<div id="alertModal" class="modal">
    <div class="modal-content" style="max-width: 400px;">
        <span class="close" onclick="closeAlertModal()">&times;</span>
        <h2>Melding</h2>
        <p id="alertMessage" style="margin: 20px 0;"></p>
        <div style="display: flex; justify-content: flex-end; margin-top: 20px;">
            <button type="button" class="btn" onclick="closeAlertModal()">OK</button>
        </div>
    </div>
</div>

<!-- Edit Round Modal -->
<div id="editRoundModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeEditModal()">&times;</span>
        <h2>Ronde Bewerken</h2>
        <form id="editRoundForm" method="POST">
            <div class="form-group">
                <label for="edit-contract">Contract</label>
                <select id="edit-contract" name="contract" required onchange="updateEditFormVisibility()">
                    <option value="">Selecteer contract</option>
                    <option value="Vraag">Vraag</option>
                    <option value="Abondance">Abondance</option>
                    <option value="Miserie">Miserie</option>
                    <option value="Grote Miserie">Grote Miserie</option>
                    <option value="Troel">Troel</option>
                    <option value="Solo">Solo</option>
                </select>
            </div>

            <div class="form-group" id="edit-trump-group">
                <label>Troef</label>
                <div class="trump-options">
                    <label class="trump-label">
                        <input type="radio" name="trump_suit" value="harten" onclick="clearEditTrumpValidity()"> ♥
                        Harten
                    </label>
                    <label class="trump-label">
                        <input type="radio" name="trump_suit" value="schoppen" onclick="clearEditTrumpValidity()"> ♠
                        Schoppen
                    </label>
                    <label class="trump-label">
                        <input type="radio" name="trump_suit" value="ruiten" onclick="clearEditTrumpValidity()"> ♦
                        Ruiten
                    </label>
                    <label class="trump-label">
                        <input type="radio" name="trump_suit" value="klaveren" onclick="clearEditTrumpValidity()"> ♣
                        Klaveren
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label for="edit-main-player">Speler</label>
                <select id="edit-main-player" name="main_player" required>
                    {% for player in players %}
                    <option value="{{ player.id }}">{{ player.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group" id="edit-partner-group">
                <label for="edit-partner">Partner (Alleen bij Vraag)</label>
                <select id="edit-partner" name="partner_id">
                    <option value="">Geen (Alleenspel)</option>
                    {% for player in players %}
                    <option value="{{ player.id }}">{{ player.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label>Resultaat</label>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="result" value="Gewonnen" id="edit-result-won"> Gewonnen
                    </label>
                    <label>
                        <input type="radio" name="result" value="Verloren" id="edit-result-lost"> Verloren
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label for="edit-tricks">Extra Slagen / Details (Optioneel)</label>
                <input type="number" id="edit-tricks" name="tricks" value="0" placeholder="0">
                <small>Bv. aantal overslagen bij Vraag</small>
            </div>

            <button type="submit" class="btn btn-primary full-width">Opslaan</button>
        </form>
    </div>
</div>

<script>
    // Modal Logic
    var modal = document.getElementById("addRoundModal");
    var btn = document.getElementById("addRoundBtn");
    var span = document.getElementsByClassName("close")[0];

    btn.onclick = function () {
        modal.style.display = "block";
    }

    span.onclick = function () {
        modal.style.display = "none";
    }

    window.onclick = function (event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    // Clear trump validity on all radio buttons when one is selected
    function clearTrumpValidity() {
        const trumpRadios = document.querySelectorAll('input[name="trump_suit"]');
        trumpRadios.forEach(radio => radio.setCustomValidity(''));
    }

    // Dynamic Partner & Miserie Selection
    const contractSelect = document.getElementById('contract');
    const partnerGroup = document.getElementById('partner-group');
    const miserieGroup = document.getElementById('miserie-group');
    const mainPlayerGroup = document.querySelector('label[for="main_player"]').closest('.form-group');
    const resultContainer = document.querySelector('.radio-group').closest('.form-group');

    const partnerSelect = document.getElementById('partner_id');
    const trumpGroup = document.getElementById('trump-group');

    function updatePartnerVisibility() {
        const val = contractSelect.value;

        // Reset defaults
        partnerGroup.style.display = 'none';
        miserieGroup.style.display = 'none';
        mainPlayerGroup.style.display = 'block';
        resultContainer.style.display = 'block';
        trumpGroup.style.display = 'none'; // Default hidden

        if (val === 'Vraag' || val === 'Troel') {
            partnerGroup.style.display = 'block';
            trumpGroup.style.display = 'block'; // Show for Vraag/Troel
            document.querySelector('label[for="partner_id"]').textContent = 'Partner';

            // Troel: Force Partner (Hide "Geen")
            // Vraag: Allow "Geen" (Alleenspel)
            const noneOption = partnerSelect.querySelector('option[value=""]');
            if (val === 'Troel') {
                if (noneOption) noneOption.hidden = true;
                partnerSelect.required = true;
                if (partnerSelect.value === "") partnerSelect.value = "";
            } else {
                if (noneOption) noneOption.hidden = false;
                partnerSelect.required = false;
            }

        }

        if (val === 'Vraag' || val === 'Troel' || val === 'Abondance' || val === 'Solo') {
            trumpGroup.style.display = 'block';
            // Make trump selection mandatory
            const trumpRadios = document.querySelectorAll('input[name="trump_suit"]');
            trumpRadios.forEach(radio => radio.required = true);
        } else {
            // Not required for Miserie
            const trumpRadios = document.querySelectorAll('input[name="trump_suit"]');
            trumpRadios.forEach(radio => radio.required = false);
        }

        if (val === 'Miserie' || val === 'Grote Miserie') {
            partnerGroup.style.display = 'none';
            miserieGroup.style.display = 'block';
            mainPlayerGroup.style.display = 'none';
            resultContainer.style.display = 'none';
            partnerSelect.value = '';

            // Hide sitter in miserie rows
            const sitterId = "{{ current_sitter_id }}";
            if (sitterId && sitterId !== "None") {
                const row = document.querySelector('.miserie-player-row[data-player-id="' + sitterId + '"]');
                if (row) row.style.display = 'none';
            }
        } else {
            partnerSelect.value = '';
        }
    }

    window.toggleMiserieResult = function (checkbox, playerId) {
        const resultDiv = document.getElementById('miserie-result-' + playerId);
        resultDiv.style.display = checkbox.checked ? 'inline-block' : 'none';
    }

    // Initialize
    updatePartnerVisibility();
    contractSelect.addEventListener('change', updatePartnerVisibility);

    // Prevent self-partner selection
    const mainPlayerSelect = document.getElementById('main_player');
    const tricksInput = document.getElementById('tricks');

    function updatePartnerOptions() {
        const selectedMainId = mainPlayerSelect.value;
        const options = partnerSelect.options;
        const sitterId = "{{ current_sitter_id }}";

        for (let i = 0; i < options.length; i++) {
            const opt = options[i];
            // Skip empty option
            if (opt.value === "") continue;

            // Disable if main player OR sitter
            if (opt.value === selectedMainId) {
                opt.disabled = true;
                if (partnerSelect.value === selectedMainId) {
                    partnerSelect.value = ""; // Reset if current selection becomes invalid
                }
            } else if (opt.value === sitterId && sitterId !== "None") {
                opt.disabled = true;
            } else {
                opt.disabled = false;
            }
        }
    }

    function updateTricksConstraint() {
        const val = contractSelect.value;
        const result = document.querySelector('input[name="result"]:checked').value;
        let maxTricks = 5; // Default for Vraag/Troel Won

        if (val === 'Abondance') {
            maxTricks = (result === 'Gewonnen') ? 4 : 9;
        } else if (val === 'Miserie' || val === 'Grote Miserie') {
            maxTricks = 0;
            tricksInput.value = 0;
            tricksInput.disabled = true;
        } else if (val === 'Solo') {
            maxTricks = 0;
            tricksInput.value = 0;
            tricksInput.disabled = true;
        } else {
            // Vraag / Troel
            maxTricks = (result === 'Gewonnen') ? 5 : 8;
            tricksInput.disabled = false;
        }

        tricksInput.setAttribute('max', maxTricks);
        tricksInput.placeholder = "0 - " + maxTricks;

        // Ensure current value is valid
        if (tricksInput.value && parseInt(tricksInput.value) > maxTricks) {
            tricksInput.value = maxTricks;
        }
    }

    mainPlayerSelect.addEventListener('change', updatePartnerOptions);
    contractSelect.addEventListener('change', updateTricksConstraint);

    // Add listeners to result radio buttons
    const resultRadios = document.querySelectorAll('input[name="result"]');
    resultRadios.forEach(radio => {
        radio.addEventListener('change', updateTricksConstraint);
    });

    // Initial call to set state
    updatePartnerOptions();
    updateTricksConstraint();

    // Hide Sitter in Selects
    const sitterId = "{{ current_sitter_id }}";
    if (sitterId && sitterId !== "None") {
        const options = document.querySelectorAll('option[value="' + sitterId + '"]');
        options.forEach(opt => {
            opt.disabled = true;
            opt.textContent += " (Zit stil)";
        });
    }

    // Auto-remove main player from partner options? Optional enhancement.

    // Custom modal functions
    function showConfirmModal(message, onConfirm) {
        const modal = document.getElementById('confirmDeleteModal');
        const messageEl = document.getElementById('confirmMessage');
        const okBtn = document.getElementById('confirmOkBtn');

        messageEl.textContent = message;
        modal.style.display = 'block';

        // Remove old event listeners and add new one
        const newOkBtn = okBtn.cloneNode(true);
        okBtn.parentNode.replaceChild(newOkBtn, okBtn);

        newOkBtn.onclick = function () {
            modal.style.display = 'none';
            onConfirm();
        };
    }

    function closeConfirmModal() {
        document.getElementById('confirmDeleteModal').style.display = 'none';
    }

    function showAlertModal(message) {
        const modal = document.getElementById('alertModal');
        const messageEl = document.getElementById('alertMessage');

        messageEl.textContent = message;
        modal.style.display = 'block';
    }

    function closeAlertModal() {
        document.getElementById('alertModal').style.display = 'none';
    }

    // Delete round confirmation
    function confirmDelete(roundNumber) {
        const message = `Weet je zeker dat je ronde #${roundNumber} wilt verwijderen? Alle scores worden opnieuw berekend.`;

        showConfirmModal(message, function () {
            const rounds = {{ rounds | tojson
        }};
    const round = rounds.find(r => r.round_number === roundNumber);
    if (round) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/round/delete/${round.id}`;
        document.body.appendChild(form);
        form.submit();
    }
        });
    }

    // Edit modal functions
    function openEditModal(roundNumber) {
        const rounds = {{ rounds | tojson
    }};
    const round = rounds.find(r => r.round_number === roundNumber);

    if (!round) {
        showAlertModal('Ronde niet gevonden!');
        return;
    }

    // Fetch round data from server to get complete details
    fetch(`/round/edit/${round.id}`)
        .then(response => response.json())
        .then(data => {
            // Set form action
            document.getElementById('editRoundForm').action = `/round/update/${data.id}`;

            // Pre-fill contract
            document.getElementById('edit-contract').value = data.contract;

            // Pre-fill trump suit if applicable
            if (data.trump_suit) {
                const trumpRadio = document.querySelector(`#editRoundModal input[name="trump_suit"][value="${data.trump_suit}"]`);
                if (trumpRadio) trumpRadio.checked = true;
            }

            // Pre-fill main player
            document.getElementById('edit-main-player').value = data.main_player_id;

            // Pre-fill partner
            document.getElementById('edit-partner').value = data.partner_id || '';

            // Pre-fill result
            if (data.result === 'Gewonnen') {
                document.getElementById('edit-result-won').checked = true;
            } else {
                document.getElementById('edit-result-lost').checked = true;
            }

            // Pre-fill tricks
            document.getElementById('edit-tricks').value = data.tricks || 0;

            // Update form visibility based on contract
            updateEditFormVisibility();

            // Show modal
            document.getElementById('editRoundModal').style.display = 'block';
        })
        .catch(error => {
            console.error('Error fetching round data:', error);
            showAlertModal('Fout bij het ophalen van ronde gegevens.');
        });
    }

    function closeEditModal() {
        document.getElementById('editRoundModal').style.display = 'none';
    }

    function updateEditFormVisibility() {
        const contract = document.getElementById('edit-contract').value;
        const trumpGroup = document.getElementById('edit-trump-group');
        const partnerGroup = document.getElementById('edit-partner-group');
        const trumpRadios = document.querySelectorAll('#editRoundModal input[name="trump_suit"]');

        // Show/hide trump based on contract
        if (['Vraag', 'Abondance', 'Troel', 'Solo'].includes(contract)) {
            trumpGroup.style.display = 'block';
            trumpRadios.forEach(radio => radio.required = true);
        } else {
            trumpGroup.style.display = 'none';
            trumpRadios.forEach(radio => {
                radio.required = false;
                radio.checked = false;
            });
        }

        // Show/hide partner based on contract (only for Vraag)
        if (contract === 'Vraag') {
            partnerGroup.style.display = 'block';
        } else {
            partnerGroup.style.display = 'none';
            document.getElementById('edit-partner').value = '';
        }
    }

    function clearEditTrumpValidity() {
        const trumpRadios = document.querySelectorAll('#editRoundModal input[name="trump_suit"]');
        trumpRadios.forEach(radio => radio.setCustomValidity(''));
    }

    // Undo last round with confirmation
    function confirmUndo() {
        const message = 'Weet je zeker dat je de laatste ronde ongedaan wilt maken? Deze actie kan niet ongedaan worden gemaakt.';

        showConfirmModal(message, function () {
            // Create and submit form to undo endpoint
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '{{ url_for("undo_round") }}';
            document.body.appendChild(form);
            form.submit();
        });
    }

</script>
{% endblock %}